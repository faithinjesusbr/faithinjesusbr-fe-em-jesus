import requests
import random
import datetime

# âœ… Token Hugging Face que vocÃª criou
HUGGINGFACE_TOKEN = "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"

# ğŸ”’ Base local se a internet ou API falhar
versiculos_por_sentimento = {
    "triste": [
        "O Senhor estÃ¡ perto dos que tÃªm o coraÃ§Ã£o quebrantado. - Salmos 34:18",
        "LanÃ§a o teu cuidado sobre o Senhor, e ele te susterÃ¡. - Salmos 55:22"
    ],
    "alegre": [
        "Alegrai-vos sempre no Senhor. - Filipenses 4:4",
        "O coraÃ§Ã£o alegre aformoseia o rosto. - ProvÃ©rbios 15:13"
    ],
    "ansioso": [
        "NÃ£o andeis ansiosos por coisa alguma. - Filipenses 4:6",
        "Confia no Senhor de todo o teu coraÃ§Ã£o. - ProvÃ©rbios 3:5"
    ],
    "esperanÃ§a": [
        "Os que esperam no Senhor renovarÃ£o as suas forÃ§as. - IsaÃ­as 40:31",
        "Bendito o homem que confia no Senhor. - Jeremias 17:7"
    ]
}

# ğŸ—“ VersÃ­culo diferente por dia (baseada no dia do mÃªs)
versiculos_do_dia = [
    "Porque eu bem sei os planos que tenho para vÃ³s. - Jeremias 29:11",
    "O Senhor Ã© o meu pastor, nada me faltarÃ¡. - Salmos 23:1",
    "Buscai primeiro o Reino de Deus. - Mateus 6:33",
    "Tudo posso naquele que me fortalece. - Filipenses 4:13"
]

def versiculo_do_dia():
    dia = datetime.datetime.now().day
    return versiculos_do_dia[dia % len(versiculos_do_dia)]

# ğŸ¯ Gera versÃ­culo por IA Hugging Face ou base local
def gerar_versiculo(sentimento=None):
    try:
        print("ğŸ”„ Usando Hugging Face IA...")
        url = "https://api-inference.huggingface.co/models/lorrabomfim/biblia-em-portugues"
        headers = {"Authorization": f"Bearer {HUGGINGFACE_TOKEN}"}
        payload = {"inputs": f"VersÃ­culo para: {sentimento or 'esperanÃ§a'}"}

        response = requests.post(url, headers=headers, json=payload, timeout=5)
        if response.status_code == 200:
            return response.json()[0]['generated_text']
        else:
            raise Exception("Erro Hugging Face")
    except:
        print("âš ï¸ Falha na IA, usando base offline...")
        if sentimento in versiculos_por_sentimento:
            return random.choice(versiculos_por_sentimento[sentimento])
        return random.choice(sum(versiculos_por_sentimento.values(), []))

# ğŸ”— Compartilhamento
def compartilhar_versiculo(texto):
    whatsapp = f"https://api.whatsapp.com/send?text={texto.replace(' ', '%20')}"
    instagram = f"https://www.instagram.com/create/story/?text={texto.replace(' ', '%20')}"
    return whatsapp, instagram

# ğŸ§ª Teste direto no terminal
if __name__ == "__main__":
    sentimento_usuario = "esperanÃ§a"
    print("ğŸ“– VersÃ­culo do dia:", versiculo_do_dia())
    print("ğŸ¤– VersÃ­culo por sentimento:", gerar_versiculo(sentimento_usuario))
    links = compartilhar_versiculo(versiculo_do_dia())
    print("ğŸ”— WhatsApp:", links[0])
    print("ğŸ”— Instagram:", links[1])
